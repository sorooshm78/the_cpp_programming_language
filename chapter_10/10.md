# Expressions

## 10.1 Introduction
ุงู ูุตู ุนุจุงุฑุชโูุง ุฑุง ุจุง ุฌุฒุฆุงุช ุจุฑุฑุณ ูโฺฉูุฏ. ุฏุฑ ++Cุ ุงูุชุณุงุจ ฺฉ ุนุจุงุฑุช ุงุณุชุ ูุฑุงุฎูุงู ุชุงุจุน ฺฉ ุนุจุงุฑุช ุงุณุชุ ุณุงุฎุชูู ฺฉ ุดุก ฺฉ ุนุจุงุฑุช ุงุณุชุ ู ุจุณุงุฑ ุนููุงุช ุฏฺฏุฑ ฺฉู ูุฑุงุชุฑ ุงุฒ ุงุฑุฒุงุจู ูุชุนุงุฑูู ุนุจุงุฑุงุชู ุญุณุงุจ ูโุฑููุฏ ูุฒ ุนุจุงุฑุชโุงูุฏ. ุจุฑุง ุงูฺฉู ุชุตูุฑ ุงุฒ ฺฺฏููฺฏู ุงุณุชูุงุฏูู ุนุจุงุฑุชโูุง ุจุฏูู ู ุขูโูุง ุฑุง ุฏุฑ ุจุณุชุฑุดุงู ูุดุงู ุฏููุ ุงุจุชุฏุง ฺฉ ุจุฑูุงููู ฺฉูฺฺฉ ู ฺฉุงูู ุงุฑุงุฆู ูโฺฉูู: ฺฉ ยซูุงุดูโุญุณุงุจ ุฑููุฒยป ุณุงุฏู. ุณูพุณ ูุฌููุนูู ฺฉุงููู ุนููฺฏุฑูุง ููุฑุณุช ูโุดูุฏ ู ูุนูุง ุขูโูุง ุจุฑุง ููุนโูุง ุฏุฑููโุณุงุฎุช ุจูโุงุฎุชุตุงุฑ ุจุงู ูโฺฏุฑุฏุฏ. ุนููฺฏุฑูุง ฺฉู ุจู ุชูุถุญ ฺฏุณุชุฑุฏูโุชุฑ ูุงุฒ ุฏุงุฑูุฏ ุฏุฑ ูุตู ฑฑ ุจุฑุฑุณ ูโุดููุฏ.

## 10.2 A Desk Calculator
ฺฉ ุจุฑูุงููู ุณุงุฏูู ยซูุงุดูโุญุณุงุจ ุฑููุฒยป ุฑุง ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ ฺฉู ฺูุงุฑ ุนูู ุงุณุชุงูุฏุงุฑุฏ ุญุณุงุจ ุฑุง ุจูโุตูุฑุช ุนููฺฏุฑูุง ูุงูููุฏ ุฑู ุงุนุฏุงุฏ ููุฒ ุดูุงูุฑ ูุฑุงูู ูโฺฉูุฏ. ฺฉุงุฑุจุฑ ููฺูู ูโุชูุงูุฏ ูุชุบุฑ ุชุนุฑู ฺฉูุฏ. ุจุฑุง ูููููุ ุงฺฏุฑ ูุฑูุฏ ฺูู ุจุงุดุฏ:

```
r = 2.5
area = pi * r * r
```

(pi ุงุฒ ูพุด ุชุนุฑู ุดุฏู ุงุณุช) ุจุฑูุงููู ูุงุดูโุญุณุงุจ ูโููุณุฏ:

```
2.5
19.635
```

ฺฉู ุฏุฑ ุขู 2.5 ูุชุฌูู ุฎุทู ูุฎุณุชู ูุฑูุฏ ู 19.635 ูุชุฌูู ุฎุทู ุฏูู ุงุณุช.

ุงู ูุงุดูโุญุณุงุจ ุงุฒ ฺูุงุฑ ุจุฎุด ุงุตู ุชุดฺฉู ุดุฏู ุงุณุช: ฺฉ ยซุชุฌุฒูโฺฏุฑยป (parser)ุ ฺฉ ยซุชุงุจุน ูุฑูุฏยปุ ฺฉ ยซุฌุฏูู ููุงุฏูุงยปุ ู ฺฉ ยซุฑุงูโุงูุฏุงุฒยป (driver). ุฏุฑ ูุงูุนุ ุงู ฺฉ ฺฉุงููพุงูุฑ ฺฉูฺฺฉ ุงุณุช ฺฉู ุฏุฑ ุขู ุชุฌุฒูโฺฏุฑ ุชุญูู ูุญู ุฑุง ุงูุฌุงู ูโุฏูุฏุ ุชุงุจุน ูุฑูุฏ ูุณุฆููู ุฏุฑุงูุช ูุฑูุฏ ู ุชุญูู ูุงฺฺฏุงู ุงุณุชุ ุฌุฏูู ููุงุฏูุง ุงุทูุงุนุงุชู ุฏุงุฆู ุฑุง ูฺฏู ูโุฏุงุฑุฏุ ู ุฑุงูโุงูุฏุงุฒ ูุธููู ููุฏุงุฑุฏูู ุงูููุ ุฎุฑูุฌุ ู ุฑุณุฏฺฏ ุจู ุฎุทุงูุง ุฑุง ุจุฑ ุนูุฏู ุฏุงุฑุฏ. ูโุชูุงูุณุชู ูุงุจูุชโูุง ุจุณุงุฑ ุจู ุงู ูุงุดูโุญุณุงุจ ุจูุฒุงู ุชุง ฺฉุงุฑุจุฑุฏโุชุฑ ุดูุฏุ ุงูุง ููู ุญุงูุง ูู ฺฉุฏ ุจูโุงูุฏุงุฒูู ฺฉุงู ุทููุงู ุงุณุช ู ุจุดุชุฑู ุขู ูุงุจูุชโูุง ููุท ฺฉุฏ ุจุดุชุฑ ุงุถุงูู ูโฺฉููุฏ ุจโุขูโฺฉู ุจูุด ุจุดุชุฑ ุฏุฑุจุงุฑูู ุงุณุชูุงุฏู ุงุฒ ++C ูุฑุงูู ฺฉููุฏ.

## 10.2.1 The Parser
ุฏุฑ ุงูุฌุง ุฏุณุชูุฑ ุฒุจุงู (grammar) ุฒุจุงู ฺฉู ูุงุดูโุญุณุงุจ ูโูพุฐุฑุฏ ุขูุฏู ุงุณุช:

```
program:
    end                 // end ุนู ูพุงุงูู ูุฑูุฏ
    expr_list end

expr_list:
    expression print    // print ุนู ุณุทุฑู ุฌุฏุฏ (newline) ุง ููุทูโูุฑฺฏูู (;)
    expression print expr_list

expression:
    expression + term
    expression โ term
    term

term:
    term / primary
    term โ primary
    primary

primary:
    number              // number ุนู ฺฉ ุนุฏุฏู ููุฒ ุดูุงูุฑ (literal)
    name                // name ุนู ฺฉ ุดูุงุณู (identifier)
    name = expression
    โ primary
    ( expression )
```

ุจู ุจุงู ุฏฺฏุฑุ ฺฉ ยซุจุฑูุงููยป ุฏูุจุงููโุง ุงุฒ ุนุจุงุฑุชโูุงุณุช ฺฉู ุจุง ููุทูโูุฑฺฏูู ุงุฒ ูู ุฌุฏุง ูโุดููุฏ. ูุงุญุฏูุง ูพุงูู ฺฉ ุนุจุงุฑุช ุนุจุงุฑุชโุงูุฏ ุงุฒ ุนุฏุฏูุงุ ูุงูโูุงุ ู ุนููฺฏุฑูุง โ ู / ู + ู โ (ูู ฺฉุงู ู ูู ุฏูุชุง) ู ูุฒ = (ุงูุชุณุงุจ). ูุงูโูุง ูุงุฒู ูุณุช ูพุด ุงุฒ ุงุณุชูุงุฏู ุงุนูุงู ุดููุฏ.

ูู ุงุฒ ุณุจฺฉ ุจุฑุง ุชุญูู ูุญู (syntax analysis) ุงุณุชูุงุฏู ูโฺฉูู ฺฉู ยซูุฒูู ุจุงุฒฺฏุดุชยป (recursive descent) ูุงู ุฏุงุฑุฏุ ุฑูุด ุณุฑุฑุงุณุช ู ุฑุงุฌ ุงุฒ ุจุงูุง ุจู ูพุงู ุงุณุช. ุฏุฑ ุฒุจุงู ูุงููุฏ ++C ฺฉู ูุฑุงุฎูุงูู ุชุงุจุน ุงุฑุฒุงู ุงุณุชุ ุงู ุฑูุด ฺฉุงุฑุขูุฏ ูู ูุณุช. ุจุฑุง ูุฑ ูุงุนุฏูู ุฏุณุชูุฑ ุฒุจุงูุ ุชุงุจุน ุฏุงุฑู ฺฉู ุชูุงุจุน ุฏฺฏุฑ ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏ. ูุดุงููโูุง ูพุงุงูู (terminal) โ ูุงููุฏ endุ numberุ + ู โ โ ุชูุณุท ยซุชุญููฺฏุฑ ูุงฺฺฏุงูยป (lexer) ุชุดุฎุต ุฏุงุฏู ูโุดููุฏ ู ูุดุงููโูุง ูุงูพุงุงูู ุชูุณุท ุชูุงุจุนู ุชุญููฺฏุฑ ูุญูุ ุนู โ`expr()`โุ โ`term()`โุ ู โ`prim()`โ. ููู ฺฉู ูุฑ ุฏู ุนููููุฏ ฺฉ (ุฒุฑ)ุนุจุงุฑุช ูุนููู ุดุฏุ ุนุจุงุฑุช ุงุฑุฒุงุจ ูโุดูุฏุ ุฏุฑ ฺฉ ฺฉุงููพุงูุฑ ูุงูุนุ ุฏุฑ ููู ููุทู ูโุชูุงู ฺฉุฏ ุชููุฏ ฺฉุฑุฏ.

ุจุฑุง ูุฑูุฏุ ุชุฌุฒูโฺฏุฑ ุงุฒ โ`Token_stream`โ ุงุณุชูุงุฏู ูโฺฉูุฏ ฺฉู ุฎูุงูุฏู ฺฉุงุฑุงฺฉุชุฑูุง ู ุณุงุฎุชูู ุขูโูุง ุจู ยซูุดุงููยปูุง (Token) ุฑุง ุฏุฑ ุฎูุฏ ฺฉูพุณููู ูโฺฉูุฏ. ุนู โ`Token_stream`โ ยซุชูฺฉูโุณุงุฒยป ูโฺฉูุฏ: ุฏูุจุงููโูุง ฺฉุงุฑุงฺฉุชุฑ ูุซู โ`123.45`โ ุฑุง ุจู Token ุชุจุฏู ูโฺฉูุฏ. ฺฉ Token ุฌูุชู โ`{kind-of-token, value}`โ ุงุณุชุ ูุงููุฏ โ`{number, 123.45}`โ ฺฉู ุฏุฑ ุขู 123.45 ุจู ููุฏุงุฑ ููุฒ ุดูุงูุฑ ุชุจุฏู ุดุฏู ุงุณุช. ุจุฎุดโูุง ุงุตูู ุชุฌุฒูโฺฏุฑ ููุท ูุงุฒู ุงุณุช ูุงูู โ`Token_stream`โ (ูุซูุงู โ`ts`โ) ุฑุง ุจุฏุงููุฏ ู ุงูโฺฉู ฺฺฏููู ุงุฒ ุขู Token ุจฺฏุฑูุฏ: ุจุฑุง ุฎูุงูุฏูู Token ุจุนุฏ โ`ts.get()`โ ุฑุง ุตุฏุง ูโุฒููุฏุ ุจุฑุง ฺฏุฑูุชูู ุขุฎุฑู Token ุฎูุงูุฏูโุดุฏู (Token ยซุฌุงุฑยป) โ`ts.current()`โ ุฑุง. ุงูุฒูู ุจุฑ ุชูฺฉูโุณุงุฒุ โ`Token_stream`โ ููุจุน ูุงูุนู ฺฉุงุฑุงฺฉุชุฑูุง ุฑุง ูพููุงู ูโฺฉูุฏ: ุฎูุงู ุงุฒ ุชุงูพ ูุณุชููู ฺฉุงุฑุจุฑ ุฑู โ`cin`โ ุจุงุฏุ ุฎูุงู ุงุฒ ุฎุทู ูุฑูุงูู ุจุฑูุงููุ ุง ูุฑ ุฌุฑุงูู ูุฑูุฏู ุฏฺฏุฑ (ยง10.2.7).

ุชุนุฑูู โ`Token`โ ฺูู ุงุณุช:

```cpp
enum class Kind : char {
    name, number, end,
    plus='+', minus='โ', mul='โ', div='/', print=';', assign='=', lp='(', rp=')'
};

struct Token {
    Kind   kind;
    string string_value;
    double number_value;
};
```

ููุงุดู ูุฑ Token ุจุง ููุฏุงุฑู ุตุญุญู ฺฉุงุฑุงฺฉุชุฑู ูุชูุงุธุฑุ ูู ุฑุงุญุช ู ูู ฺฉุงุฑุขูุฏ ุงุณุช ู ุจู ฺฉุงุฑู ุฑูุนโุงุดฺฉุงู ูู ูโุขุฏ. ุงู ุฑูุด ุชุง ููุช ฺฉุงุฑ ูโฺฉูุฏ ฺฉู ูฺ ฺฉุงุฑุงฺฉุชุฑ ฺฉู ุจูโุนููุงู ูุฑูุฏ ุจูโฺฉุงุฑ ูโุฑูุฏุ ุงุฑุฒุด ุจุฑุงุจุฑ ุจุง ฺฉ ุงุฒ ุดูุงุฑุดฺฏุฑูุง ูุฏุงุดุชู ุจุงุดุฏ โ ู ุฏุฑ ูฺ ูุฌููุนูโฺฉุงุฑุงฺฉุชุฑู ุงูุฑูุฒโุง ฺฉู ูโุดูุงุณูุ ฺฉุงุฑุงฺฉุชุฑู ูุงุจูู ฺุงูพ ุจุง ููุฏุงุฑู ุตุญุญู ุชฺฉโุฑูู ูุฌูุฏ ูุฏุงุฑุฏ.

ูุงุณุทู โ`Token_stream`โ ฺูู ุงุณุช:

```cpp
class Token_stream {
public:
    Token get();            // ุฎูุงูุฏู ู ุจุฑฺฏุฑุฏุงูุฏูู Token ุจุนุฏ
    const Token& current(); // ุขุฎุฑู Token ุฎูุงูุฏูโุดุฏู
    // ...
};
```

ูพุงุฏูโุณุงุฒ ุฏุฑ ยง10.2.2 ุขูุฏู ุงุณุช.

ูุฑ ุชุงุจุนู ูพุงุฑุณุฑ ฺฉ ุขุฑฺฏููุงูู โ`bool`โ ุจู ูุงูู โ`get`โ ูโฺฏุฑุฏ (ยง6.2.2) ฺฉู ูุดุฎุต ูโฺฉูุฏ ุขุง ูุงุฒู ุงุณุช โ`Token_stream::get()`โ ุฑุง ุจุฑุง ฺฏุฑูุชูู Token ุจุนุฏ ุตุฏุง ุจุฒูุฏ ุง ูู. ูุฑ ุชุงุจุนู ูพุงุฑุณุฑ ยซุนุจุงุฑุชู ุฎูุฏุดยป ุฑุง ุงุฑุฒุงุจ ูโฺฉูุฏ ู ููุฏุงุฑ ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ. ุชุงุจุน โ`expr()`โ ุฌูุน ู ุชูุฑู ุฑุง ุฑุณุฏฺฏ ูโฺฉูุฏ. ุงู ุชุงุจุน ฺฉ ุญูููู ูุงุญุฏ ุฏุงุฑุฏ ฺฉู ุจูโุฏูุจุงู ุฌููุงุช (term) ุจุฑุง ุฌูุน ุง ุชูุฑู ูโฺฏุฑุฏุฏ:

```cpp
double expr(bool get) // ุฌูุน ู ุชูุฑู
{
    double left = term(get);
    for (;;) {           // ยซุชุง ุงุจุฏยป
        switch (ts.current().kind) {
        case Kind::plus:
            left += term(true);
            break;
        case Kind::minus:
            left -= term(true);
            break;
        default:
            return left;
        }
    }
}
```

ุงู ุชุงุจุน ุฎูุฏุด ฺฉุงุฑู ุฒุงุฏ ุงูุฌุงู ููโุฏูุฏ. ุจูโุทูุฑๅธๅ ุจุฑุง ุชูุงุจุนู ุณุทุญู ุจุงูุงุชุฑ ุฏุฑ ฺฉ ุจุฑูุงููู ุจุฒุฑฺฏุ ฺฉุงุฑ ุฑุง ุจู ุชูุงุจุนู ุฏฺฏุฑ ูุงฺฏุฐุงุฑ ูโฺฉูุฏ.

ุนุจุงุฑุชู โ`switch`โ (ยง2.2.4ุ ยง9.4.2) ููุฏุงุฑู ุดุฑุทู ุฏุงุฎู ูพุฑุงูุชุฒ ูพุณ ุงุฒ ฺฉูุฏูุงฺูู โ`switch`โ ุฑุง ุจุง ูุฌููุนูโุง ุงุฒ ุซุงุจุชโูุง ููุงุณู ูโฺฉูุฏ. โ`break`โ ุจุฑุง ุฎุฑูุฌ ุงุฒ โ`switch`โ ุจูโฺฉุงุฑ ูโุฑูุฏ. ุงฺฏุฑ ููุฏุงุฑู ุขุฒูุงุดโุดุฏู ุจุง ูฺ ุจุฑฺุณุจู โ`case`โุง ุชุทุจู ูฺฉูุฏุ โ`default`โ ุงูุชุฎุงุจ ูโุดูุฏุ ููุณูุฏูู ุจุฑูุงูู ูุฌุจูุฑ ูุณุช โ`default`โ ุจููุณุฏ.

ุชูุฌู ฺฉูุฏ ุนุจุงุฑุช ูุงููุฏ โ`2โ3+4`โ ูุทุงุจูู ุฏุณุชูุฑ ุฒุจุงู ุจูโุตูุฑุช โ`(2โ3)+4`โ ุงุฑุฒุงุจ ูโุดูุฏ. ูฺฏุงุฑุดู ฺฉูุฌฺฉุงูุงููู โ`for(;;)`โ ุฑุงู ุจุฑุง ูุดุฎุตโฺฉุฑุฏู ฺฉ ุญูููู ุจโููุงุช ุงุณุชุ ูโุชูุงูุฏ ุขู ุฑุง ยซforeverยป ุชููุธ ฺฉูุฏ (ยง9.5). โ`while(true)`โ ูู ุฌุงฺฏุฒู ุจุฑุง ุขู ุงุณุช. โ`switch`โ ุจุงุฑูุง ู ุจุงุฑูุง ุงุฌุฑุง ูโุดูุฏ ุชุง ฺุฒ ุบุฑ ุงุฒ โ`+`โ ู โ`โ`โ ูพุฏุง ฺฉูุฏุ ู ุณูพุณ โ`return`โ ุฏุฑ ุดุงุฎูู โ`default`โ ุงุฌุฑุง ูโุดูุฏ.

ุนููฺฏุฑูุง โ`+=`โ ู โ`-=`โ ุจุฑุง ุฌูุน ู ุชูุฑู ุจูโฺฉุงุฑ ุฑูุชูโุงูุฏุ ูโุดุฏ โ`left = left + term(true)`โ ู โ`left = left - term(true)`โ ููุดุช ุจโุขูโฺฉู ูุนูุง ุจุฑูุงูู ุนูุถ ุดูุฏุ ุงูุง โ`left += term(true)`โ ู โ`left -= term(true)`โ ูู ฺฉูุชุงูโุชุฑูุฏ ู ูู ููุตูุฏ ุฑุง ูุณุชููโุชุฑ ุจุงู ูโฺฉููุฏ. ูุฑ ุนููฺฏุฑู ุงูุชุณุงุจ ฺฉ Tokenู ูุงฺฺฏุงู ุฌุฏุงุณุชุ ูพุณ โ`a + = 1;`โ โ ุจูโุฏูู ูุงุตูู ุจู โ`+`โ ู โ`=`โ โ ุฎุทุง ูุญู ุงุณุช.

++C ุจุฑุง ุนููฺฏุฑูุง ุฏูุชุงู ุฒุฑ ุนููฺฏุฑู ุงูุชุณุงุจ ูุชูุงุธุฑ ูุฑุงูู ูโฺฉูุฏ:

```
+  โ  โ  /  %  &  |  ห  <<  >>
```

ู ุฏุฑ ูุชุฌู ุงู ุนููฺฏุฑูุง ุงูุชุณุงุจ ููฺฉูโุงูุฏ:

```
=  +=  โ=  โ=  /=  %=  &=  |=  ห=  <<=  >>=
```

โ`%`โ ุนููฺฏุฑู ุจุงููุงูุฏู (modulo) ุงุณุชุ โ`&`โุ โ`|`โ ู โ`ห`โ ุนููฺฏุฑูุง ุจุชู ููุทูู andุ or ู ยซxorยป ูุณุชูุฏุ โ`<<`โ ู โ`>>`โ ุนููฺฏุฑู ุดูุชู ฺูพ ู ุฑุงุณุชโุงูุฏุ ยง10.3 ุนููฺฏุฑูุง ู ูุนุงูโุดุงู ุฑุง ุฎูุงุตู ูโฺฉูุฏ. ุจุฑุง ฺฉ ุนููฺฏุฑู ุฏูุชุงู โ`@`โ ฺฉู ุฑู ุนููููุฏูุง ููุนโูุง ุฏุฑููโุณุงุฎุช ุงุนูุงู ูโุดูุฏุ ุนุจุงุฑุชู โ`x @= y`โ ุนู โ`x = x @ y`โุ ุจุง ุงู ุชูุงูุช ฺฉู โ`x`โ ููุท ฺฉ ุจุงุฑ ุงุฑุฒุงุจ ูโุดูุฏ.

ุชุงุจุนู โ`term()`โ ุถุฑุจ ู ุชูุณู ุฑุง ููุงูโฺฏููู ุฑุณุฏฺฏ ูโฺฉูุฏ ฺฉู โ`expr()`โ ุฌูุน ู ุชูุฑู ุฑุง:

```cpp
double term(bool get) // ุถุฑุจ ู ุชูุณู
{
    double left = prim(get);
    for (;;) {
        switch (ts.current().kind) {
        case Kind::mul:
            left *= prim(true);
            break;
        case Kind::div:
            if (auto d = prim(true)) {
                left /= d;
                break;
            }
            return error("divide by 0");
        default:
            return left;
        }
    }
}
```

ูุชุฌูู ุชูุณู ุจุฑ ุตูุฑ ูุงูุนู ู ูุนูููุงู ูุงุฌุนูโุจุงุฑ ุงุณุชุ ุจูุงุจุฑุงู ูพุด ุงุฒ ุชูุณูุ ุตูุฑ ุจูุฏู ุฑุง ูโุขุฒูุงู ู ุงฺฏุฑ ููุณูููโุนููู ุตูุฑ ุจูุฏ โ`error()`โ ุฑุง ุตุฏุง ูโุฒูู. โ`error()`โ ุฏุฑ ยง10.2.4 ุชูุตู ุดุฏู ุงุณุช. ูุชุบุฑ โ`d`โ ุฏููุงู ููุงูโุฌุง ฺฉู ูุงุฒู ุงุณุช ูุนุฑู ู ุจูุงูุงุตูู ููุฏุงุฑุฏู ูโุดูุฏ. ุญูุฒูู ูุงู ฺฉู ุฏุฑ ุดุฑุท ูุนุฑู ูโุดูุฏุ ููุงู ุฌูููโุง ุงุณุช ฺฉู ุขู ุดุฑุท ฺฉูุชุฑู ูโฺฉูุฏ ู ููุฏุงุฑู ุญุงุตู ูู ููุฏุงุฑู ููุงู ุดุฑุท ุงุณุช (ยง9.4.3). ุฏุฑ ูุชุฌูุ ุชูุณู ู ุงูุชุณุงุจู โ`left /= d`โ ููุท ู ููุท ููุช ุงูุฌุงู ูโุดูุฏ ฺฉู โ`d`โ ูุงุตูุฑ ุจุงุดุฏ.

ุชุงุจุนู โ`prim()`โ ฺฉู ฺฉ ยซุงูููยป (primary) ุฑุง ุฑุณุฏฺฏ ูโฺฉูุฏุ ุดุจู โ`expr()`โ ู โ`term()`โ ุงุณุชุ ุฌุฒ ุงูโฺฉู ฺูู ูพุงูโุชุฑ ุฏุฑ ุณูุณููโูุฑุงุชุจู ูุฑุงุฎูุงู ูุฑุงุฑ ฺฏุฑูุชูโุงูุ ฺฉู ยซฺฉุงุฑ ูุงูุนยป ุงูุฌุงู ูโุดูุฏ ู ุฏฺฏุฑ ูุงุฒ ุจู ุญููู ูุณุช:

```cpp
double prim(bool get) // ุฑุณุฏฺฏ ุจู primary
{
    if (get) ts.get(); // Token ุจุนุฏ ุฑุง ุจุฎูุงู
    switch (ts.current().kind) {
    case Kind::number: {                // ุซุงุจุชู ููุฒ ุดูุงูุฑ
        double v = ts.current().number_value;
        ts.get();
        return v;
    }
    case Kind::name: {                  // ฺฉ ูุงู (ุดูุงุณู)
        double& v = table[ts.current().string_value]; // ููุฏุงุฑู ูุชูุงุธุฑ ุฑุง ุจุงุจ
        if (ts.get().kind == Kind::assign)            // ุงฺฏุฑ '=' ุฏุฏู: ุงูุชุณุงุจ
            v = expr(true);
        return v;
    }
    case Kind::minus:                   // ูููู ฺฉุงู
        return -prim(true);
    case Kind::lp: {                    // '('
        auto e = expr(true);
        if (ts.current().kind != Kind::rp)
            return error("')' expected");
        ts.get();                       // ')' ุฑุง ุจุฎูุฑ
        return e;
    }
    default:
        return error("primary expected");
    }
}
```

ููุช ฺฉ โ`Token`โ ุงุฒ ููุนู ยซุนุฏุฏยป (ุนุฏุฏ ุตุญุญ ุง ููุฒ ุดูุงูุฑู literal) ุฏุฏู ูโุดูุฏุ ููุฏุงุฑุด ุฏุฑ โ`number_value`โ ูุฑุงุฑ ูโฺฏุฑุฏ. ุจูโุทูุฑ ูุดุงุจูุ ููุช โ`Token`โ ฺฉู ยซูุงูยป ุงุณุช (ูุฑ ุทูุฑ ุชุนุฑู ุดุฏูุ ยง10.2.2 ู ยง10.2.3 ุฑุง ุจุจูุฏ) ุฏุฏู ุดูุฏุ ููุฏุงุฑุด ุฏุฑ โ`string_value`โ ฺฏุฐุงุดุชู ูโุดูุฏ.

ุชูุฌู ฺฉูุฏ โ`prim()`โ ููุดู ฺฉ โ`Token`โ ุจุด ุงุฒ ุขูโฺู ุจุฑุง ุชุญููู ุนุจุงุฑุชู ุงูููโุงุด ุงุณุชูุงุฏู ูโฺฉูุฏ ูโุฎูุงููุฏ. ุฏููุด ุงู ุงุณุช ฺฉู ุฏุฑ ุจุฑุฎ ุญุงูุชโูุง ูุฌุจูุฑ ุงุณุช ฺูู ฺฉูุฏ (ูุซูุงู ุจุฑุง ุงูโฺฉู ุจุจูุฏ ุขุง ุจู ฺฉ ูุงู ุงูุชุณุงุจ ูโุดูุฏ ุง ููุท ุฎูุงูุฏู ูโุดูุฏ)ุ ุจูุงุจุฑุงูุ ุจุฑุง ฺฉููุงุฎุชุ ุฏุฑ ูููู ุญุงูุชโูุง ฺูู ูโฺฉูุฏ. ุฏุฑ ุฌุงูุง ฺฉู ฺฉ ุชุงุจุนู ูพุงุฑุณุฑ ููุท ูโุฎูุงูุฏ ุจู Tokenู ุจุนุฏ ุจุฑูุฏุ ุงุฒ ููุฏุงุฑู ุจุงุฒฺฏุดุชู โ`ts.get()`โ ุงุณุชูุงุฏู ููโฺฉูุฏ โ ุงุดฺฉุงู ูุฏุงุฑุฏุ ฺูู ูโุชูุงูู ูุชุฌู ุฑุง ุงุฒ โ`ts.current()`โ ุจฺฏุฑู. ุงฺฏุฑ ุจโุงุนุชูุง ุจู ููุฏุงุฑู ุจุงุฒฺฏุดุชู โ`get()`โ ุขุฒุงุฑู ูโุฏุงุฏุ ุง ฺฉ ุชุงุจุนู โ`read()`โ ุงุถุงูู ูโฺฉุฑุฏู ฺฉู ููุท โ`current()`โ ุฑุง ุจูโุฑูุฒ ฺฉูุฏ ู ฺุฒ ุจุฑูฺฏุฑุฏุงูุฏุ ุง ุตุฑุงุญุชุงู ูุชุฌู ุฑุง ยซุฏูุฑ ูโุฑุฎุชูยป: โ`void(ts.get());`โ.

ูพุด ุงุฒ ุงูุฌุงู ูุฑฺฉุงุฑ ุจุง ฺฉ ูุงูุ ูุงุดูโุญุณุงุจ ุจุงุฏ ุฌููุชุฑ ุฑุง ุจุจูุฏ ฺฉู ุขุง ุจู ุขู ุงูุชุณุงุจ ูโุดูุฏ ุง ููุท ุฎูุงูุฏู ูโุดูุฏ. ุฏุฑ ูุฑ ุฏู ุญุงูุชุ ยซุฌุฏููู ููุงุฏูุงยป (symbol table) ูุดูุฑุช ูโุดูุฏ. ุฌุฏูู ููุงุฏูุง ฺฉ โ`map`โ ุงุณุช (ยง4.4.3ุ ยง31.4.3):

```cpp
map<string,double> table;
```

ุนู ููุช โ`table`โ ุจุง ฺฉ โ`string`โ ุงูุฏุณโฺฏุฐุงุฑ ุดูุฏุ ููุฏุงุฑู ุญุงุตู ฺฉ โ`double`โ ูุชูุงุธุฑ ุจุง ุขู ุฑุดุชู ุงุณุช. ูุซูุงู ุงฺฏุฑ ฺฉุงุฑุจุฑ ุจููุณุฏ:

```cpp
radius = 6378.388;
```

ูุงุดูโุญุณุงุจ ุจู โ`case Kind::name`โ ูโุฑุณุฏ ู ุงูโูุง ุงุฌุฑุง ูโุดููุฏ:

```cpp
double& v = table["radius"];
// ... expr() ููุฏุงุฑู ูุงุจูู ุงูุชุณุงุจ ุฑุง ูุญุงุณุจู ูโฺฉูุฏ ...
v = 6378.388;
```

ุงุฑุฌุงุนู โ`v`โ ุจุฑุง ูฺฏูโุฏุงุดุชูู โ`double`โ ูุชูุงุธุฑ ุจุง โ`radius`โ ุจูโฺฉุงุฑ ูโุฑูุฏุ ุฏุฑ ุญุงู ฺฉู โ`expr()`โ ููุฏุงุฑู โ`6378.388`โ ุฑุง ุงุฒ ฺฉุงุฑุงฺฉุชุฑูุง ูุฑูุฏ ูุญุงุณุจู ูโฺฉูุฏ.

ูุตูโูุง 14 ู 15 ุฏุฑุจุงุฑูู ุณุงุฒูุงูโุฏูู ุจุฑูุงูู ุจู ุตูุฑุช ูุฌููุนูโุง ุงุฒ ูุงฺููโูุง ุจุญุซ ูโฺฉููุฏ. ุจุง ุงู ุญุงู โ ุจูโุฌุฒ ฺฉ ููุฑุฏ โ ุงุนูุงูโูุง ุงู ูุซุงูู ูุงุดูโุญุณุงุจ ุฑุง ูโุชูุงู ุทูุฑ ูุฑุชุจ ฺฉุฑุฏ ฺฉู ูุฑ ฺุฒ ุฏููุงู ฺฉโุจุงุฑ ู ูพุด ุงุฒ ุงุณุชูุงุฏู ุงุนูุงู ุดูุฏ. ุงุณุชุซูุง โ`expr()`โ ุงุณุช ฺฉู โ`term()`โ ุฑุง ุตุฏุง ูโุฒูุฏุ โ`term()`โ โ`prim()`โ ุฑุงุ ู โ`prim()`โ ูู ุฏูุจุงุฑู โ`expr()`โ ุฑุงุ ุงู ุญูููู ูุฑุงุฎูุงู ุจุงุฏ ุจูโูุญู ุดฺฉุณุชู ุดูุฏ. ฺฉ ุงุนูุงูู

```cpp
double expr(bool);
```

ูพุด ุงุฒ ุชุนุฑูู โ`prim()`โ ุจูโุฎูุจ ุงุฒ ุนูุฏูู ุงู ฺฉุงุฑ ุจุฑูโุขุฏ.

-----------------
-----------------
-----------------
-----------------
-----------------

ุญุชูุงู โ
ุฏุฑ ุงุฏุงูู ุชุฑุฌููโ ฺฉุงูู ู ุฑูุงู ูุชู ุขูุฑุฏู ุดุฏู ุงุณุช:

---

### **ุชุญููโฺฏุฑ (Parser)**

ุฏุฑ ุงูุฌุง ฺฉ ุฏุณุชูุฑ ุฒุจุงู (Grammar) ุจุฑุง ุฒุจุงู ูุงุดูโุญุณุงุจ ุงุฑุงุฆู ุดุฏู ุงุณุช:

```
program:
    end                  // end ุนู ูพุงุงู ูุฑูุฏ
    expr_list end

expr_list:
    expression print      // print ุนู ุณูโฺฉุงูู ุง ุฎุทโุฌุฏุฏ
    expression print expr_list

expression:
    expression + term
    expression โ term
    term

term:
    term / primary
    term โ primary
    primary

primary:
    number                // ุนุฏุฏ ุงุนุดุงุฑ
    name                  // ุดูุงุณู (ูุงู ูุชุบุฑ)
    name = expression
    โ primary
    ( expression )
```

ุจู ุนุจุงุฑุช ุฏฺฏุฑุ ฺฉ ยซุจุฑูุงููยป ูุฌููุนูโุง ุงุฒ ุนุจุงุฑุงุช ุงุณุช ฺฉู ุจุง ุณูโฺฉุงูู ุงุฒ ูู ุฌุฏุง ูโุดููุฏ.
ูุงุญุฏูุง ุงุตู ฺฉ ุนุจุงุฑุช ุดุงูู **ุนุฏุฏูุงุ ูุงูโูุง** ู ุนููฺฏุฑูุง `*`, `/`, `+`, `โ` (ููุงุฑ ู ุจุงูุฑ) ู `=` (ุชุฎุตุต) ูุณุชูุฏ.
ุฏุฑ ุงู ุฒุจุงูุ **ูุงูโูุง (ูุชุบุฑูุง)** ูุงุฒู ูุณุช ูุจู ุงุฒ ุงุณุชูุงุฏู ุงุนูุงู ุดููุฏ.

---

### **ุฑูุด ุชุญูู ูุญู: Recursive Descent**

ุฏุฑ ุงู ุฑูุด ฺฉู ยซูุฒูู ุจุงุฒฺฏุดุชยป ูุงู ุฏุงุฑุฏุ ุจุฑุง ูุฑ ูุงุนุฏูโ ูุญู ุฏุฑ ุฏุณุชูุฑ ุฒุจุงูุ ฺฉ ุชุงุจุน ูุชูุงุธุฑ ููุดุชู ูโุดูุฏ ฺฉู ุณุงุฑ ุชูุงุจุน ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏ.
ุงู ุฑูุด ุณุงุฏู ู ูุญุจูุจ ุงุณุช ู ุฏุฑ ุฒุจุงูโูุง ูุงููุฏ ++C ฺฉู ูุฑุงุฎูุงู ุชุงุจุน ุงุฑุฒุงู ุงุณุชุ ฺฉุงุฑุง ุจุงูุง ุฏุงุฑุฏ.

ุฏุฑ ุงู ุชุญููโฺฏุฑุ ูุฑ ุจุงุฑ ฺฉู ุฏู ุนููููุฏู ฺฉ ุฒุฑุนุจุงุฑุช ุดูุงุฎุชู ุดููุฏุ ููุงูโุฌุง ููุฏุงุฑ ุขู ูุญุงุณุจู ูโุดูุฏ.
ุฏุฑ ฺฉ **ฺฉุงููพุงูุฑ ูุงูุน**ุ ุฏุฑ ููู ููุทู ูโุชูุงู ุจูโุฌุง ูุญุงุณุจูุ **ฺฉุฏ ุชููุฏ ฺฉุฑุฏ**.

---

### **ุฌุฑุงู ุชูฺฉูโูุง (Token_stream)**

ูุฑูุฏู ุชุญููโฺฏุฑ ุงุฒ ฺฉ ุดุก ุจู ูุงู `Token_stream` ุฎูุงูุฏู ูโุดูุฏ.
ุงู ุดุก ูุณุฆูู ุฎูุงูุฏู ฺฉุงุฑุงฺฉุชุฑูุง ู ุณุงุฎุชู **ุชูฺฉูโูุง (Tokens)** ุงุณุชุ ุนู ูุฑุงูุฏ **ุชูฺฉูุฒู ฺฉุฑุฏู**.

ูุซูุงู ุฑุดุชูโ `"123.45"` ุจู ฺฉ ุชูฺฉู `{number, 123.45}` ุชุจุฏู ูโุดูุฏ.
ุชูฺฉู ุดุงูู ุฏู ุจุฎุด ุงุณุช:

* **kind**: ููุน ุชูฺฉู (ูุซูุงู ุนุฏุฏุ ูุงูุ ุนููฺฏุฑ ู ุบุฑู)
* **value**: ููุฏุงุฑ ุนุฏุฏ ุง ูุชู ุขู

ุชุงุจุน `ts.get()` ุชูฺฉู ุจุนุฏ ุฑุง ูโุฎูุงูุฏุ
ู `ts.current()` ุขุฎุฑู ุชูฺฉู ุฎูุงูุฏูโุดุฏู ุฑุง ุจุฑูโฺฏุฑุฏุงูุฏ.

---

### **ุชุนุฑู Token**

```cpp
enum class Kind : char {
    name, number, end,
    plus='+', minus='โ', mul='โ', div='/', print=';', assign='=', lp='(', rp=')'
};

struct Token {
    Kind kind;
    string string_value;
    double number_value;
};
```

ููุงุด ูุฑ ุชูฺฉู ุจุง ููุฏุงุฑ ุนุฏุฏู ฺฉุงุฑุงฺฉุชุฑ ุขูุ ฺฉุงุฑุง ุฑุง ุจุงูุง ูโุจุฑุฏ ู ุจุฑุง ุฏุจุงฺฏ ูุฒ ููุฏ ุงุณุช.

---

### **ุฑุงุจุท Token_stream**

```cpp
class Token_stream {
public:
    Token get();               // ุฎูุงูุฏู ุชูฺฉู ุจุนุฏ
    const Token& current();    // ุขุฎุฑู ุชูฺฉู ุฎูุงูุฏูโุดุฏู
    // ...
};
```

---

### **ุชุงุจุน expr()**

ุงู ุชุงุจุน ุนููฺฏุฑูุง ุฌูุน ู ุชูุฑู ุฑุง ูุฏุฑุช ูโฺฉูุฏ:

```cpp
double expr(bool get)  // ุฌูุน ู ุชูุฑู
{
    double left = term(get);
    for (;;) {
        switch (ts.current().kind) {
        case Kind::plus:
            left += term(true);
            break;
        case Kind::minus:
            left -= term(true);
            break;
        default:
            return left;
        }
    }
}
```

ุงูุฌุง ุญูููโ `for(;;)` ุนู **ุญูููโ ุจโููุงุช** (ูุนุงุฏู `while(true)`)ุ
ู ุฒูุงู ูุชููู ูโุดูุฏ ฺฉู ุฏฺฏุฑ ุนููฺฏุฑ + ุง โ ูุฌูุฏ ูุฏุงุดุชู ุจุงุดุฏ.

ุนุจุงุฑุช ูุงููุฏ `2โ3+4` ุจูโุตูุฑุช `(2โ3)+4` ูุญุงุณุจู ูโุดูุฏ (ุงุฒ ฺูพ ุจู ุฑุงุณุช).

---

### **ุชุงุจุน term()**

ุชุงุจุน `term()` ุนููฺฏุฑูุง ุถุฑุจ ู ุชูุณู ุฑุง ูุงููุฏ `expr()` ูู ุจุฑุง `*` ู `/` ูุฏุฑุช ูโฺฉูุฏ:

```cpp
double term(bool get)
{
    double left = prim(get);
    for (;;) {
        switch (ts.current().kind) {
        case Kind::mul:
            left *= prim(true);
            break;
        case Kind::div:
            if (auto d = prim(true)) {
                left /= d;
                break;
            }
            return error("divide by 0");
        default:
            return left;
        }
    }
}
```

ูุจู ุงุฒ ุชูุณูุ ุจุฑุฑุณ ูโุดูุฏ ฺฉู ุชูุณู ุจุฑ ุตูุฑ ุฑุฎ ูุฏูุฏุ ุฏุฑ ุบุฑ ุงู ุตูุฑุช `error()` ูุฑุงุฎูุงู ูโุดูุฏ.

---

### **ุชุงุจุน prim()**

ุชุงุจุน `prim()` ฺฉูฺฺฉโุชุฑู ุงุฌุฒุง ูุญู ุฑุง (ุงุนุฏุงุฏุ ูุชุบุฑูุงุ ูพุฑุงูุชุฒุ ููู) ุชุญูู ูโฺฉูุฏ:

```cpp
double prim(bool get)
{
    if (get) ts.get();
    switch (ts.current().kind) {
    case Kind::number:
        { double v = ts.current().number_value;
          ts.get();
          return v; }

    case Kind::name:
        { double& v = table[ts.current().string_value];
          if (ts.get().kind == Kind::assign)
              v = expr(true);
          return v; }

    case Kind::minus:
        return -prim(true);

    case Kind::lp:
        { auto e = expr(true);
          if (ts.current().kind != Kind::rp)
              return error("')' expected");
          ts.get();
          return e; }

    default:
        return error("primary expected");
    }
}
```

* ุงฺฏุฑ **ุนุฏุฏ** ุฏุฏู ุดูุฏุ ููุฏุงุฑ ุนุฏุฏ ุขู ุจุงุฒฺฏุฑุฏุงูุฏู ูโุดูุฏ.
* ุงฺฏุฑ **ูุงู** ุฏุฏู ุดูุฏุ ุฏุฑ ุฌุฏูู ููุงุฏูุง (`table`) ุฌุณุชุฌู ูโุดูุฏ. ุงฺฏุฑ ุจุนุฏ ุงุฒ ุขู ุนูุงูุช `=` ุจุงุดุฏุ ููุฏุงุฑ ุฌุฏุฏ ูุญุงุณุจู ู ุฐุฎุฑู ูโุดูุฏ.
* ุงฺฏุฑ `-` ุจุงุดุฏุ ูููู ููุฏุงุฑ ุจุนุฏ ฺฏุฑูุชู ูโุดูุฏ.
* ุงฺฏุฑ ูพุฑุงูุชุฒ ุจุงุฒ ุจุงุดุฏุ ุนุจุงุฑุช ุฏุงุฎู ูพุฑุงูุชุฒ ูุญุงุณุจู ูโุดูุฏ.

---

### **ุฌุฏูู ููุงุฏูุง (Symbol Table)**

```cpp
map<string, double> table;
```

ุงู ุฌุฏูู ูุงู ูุชุบุฑูุง ุฑุง ุจู ููุฏุงุฑุดุงู ูฺฏุงุดุช ูโฺฉูุฏ.
ูุซูุงู ุงฺฏุฑ ฺฉุงุฑุจุฑ ุจููุณุฏ:

```
radius = 6378.388;
```

ุจุฑูุงูู ููุฏุงุฑ `6378.388` ุฑุง ุฏุฑ `table["radius"]` ุฐุฎุฑู ูโฺฉูุฏ.

---

### **ูฺฉุชู ุฏุฑุจุงุฑูโ ูุงุจุณุชฺฏ ุชูุงุจุน**

ุชุงุจุน `expr()` ุชุงุจุน `term()` ุฑุง ูุฑุงุฎูุงู ูโฺฉูุฏุ
`term()` ุชุงุจุน `prim()` ุฑุงุ
ู `prim()` ุฏูุจุงุฑู `expr()` ุฑุง (ุจุฑุง ูพุฑุงูุชุฒูุง).
ุจุฑุง ุดฺฉุณุชู ุงู ุญูููโ ุงุฑุฌุงุนุ ุจุงุฏ ูุจู ุงุฒ ุชุนุฑู `prim()` ุจููุณู:

```cpp
double expr(bool);
```


-----------------
-----------------
-----------------
-----------------
-----------------


## Input

## ุชูุถุญ ุณุงุฏู ู ฺฉุงูู ูุชู

ุฎูุงูุฏู ูุฑูุฏ ุฏุฑ ุจุฑูุงูู ูุนูููุงู ุณุฎุชโุชุฑู ูุณูุช ุงุณุชุ ฺูู ุจุฑูุงูู ุจุงุฏ ุจุง ุฑูุชุงุฑูุง ูุฎุชูู ู ุงุดุชุจุงูุงุช ุงุญุชูุงูู ุงูุณุงู ฺฉูุงุฑ ุจุงุฏ. ููโุดูุฏ ุงุฒ ฺฉุงุฑุจุฑ ุงูุชุธุงุฑ ุฏุงุดุช ูุซู ูุงุดู ุฑูุชุงุฑ ฺฉูุฏ. ุจูุงุจุฑุงู ุจุฑูุงูู ุจุงุฏ ูุฑูุฏ ุฎุงู ุฑุง ุจฺฏุฑุฏ ู ุชุจุฏู ุจู ุจุฎุดโูุง ูุงุจู ูููโุชุฑ ฺฉูุฏ.

ุฏุฑ ุงูุฌุง ฺฉุงุฑ ุฎูุงูุฏู ุณุทุญ ูพุงู ูุฑูุฏ ุจุง `ts.get()` ุงูุฌุงู ูโุดูุฏ. ุงู ุชุงุจุน ฺฉุงุฑุงฺฉุชุฑูุง ุฑุง ูโฺฏุฑุฏ ู ุงุฒ ุขูโูุง **ุชูฺฉู** ูโุณุงุฒุฏ. ุชูฺฉูโูุง ุจุนุฏุงู ุชูุณุท ูุณูุชโูุง ุณุทุญ ุจุงูุงุชุฑ ุจุฑูุงูู ุงุณุชูุงุฏู ูโุดููุฏ. ูุนูููุงู ููุดุชู ฺูู ฺฉุฏ ูุงุฒู ูุณุช ฺูู ุณุณุชูโูุง ุฎูุฏุดูู ุชูุงุจุน ุงุณุชุงูุฏุงุฑุฏ ุฏุงุฑูุฏุ ุงูุง ุฏุงูุณุชู ูุญููู ฺฉุงุฑ ููุฏ ุงุณุช.

---

## ุชุนุฑู ฺฉูุงุณ Token_stream

```cpp
class Token_stream {
public:
    Token_stream(istream& s) : ip{&s}, owns{false} { }
    Token_stream(istream* p) : ip{p}, owns{true} { }
    ~Token_stream() { close(); }
    Token get(); 
    Token& current();
    void set_input(istream& s) { close(); ip = &s; owns=false; }
    void set_input(istream* p) { close(); ip = p; owns = true; }
private:
    void close() { if (owns) delete ip; }
    istream* ip;
    bool owns;
    Token ct {Kind::end};
};
```

ุงู ฺฉูุงุณ ุฑู ฺฉ ูุฑูุฏ (ูุซูุงู `cin`) ฺฉุงุฑ ูโฺฉูุฏ ู ุงุฒ ุขู ุชูฺฉู ูโุณุงุฒุฏ.

### ูฺฉุงุช ููู:

* `ip` = ุงุดุงุฑูโฺฏุฑ ุจู ูุฑูุฏ
* `owns` = ุขุง ุงู ฺฉูุงุณ ูุงูฺฉ ูุฑูุฏ ุงุณุชุ

  * ุงฺฏุฑ ูุฑูุฏ **reference** ุจุงุดุฏ โ ูุงูฺฉ ูุณุช (ุญุฐู ููโฺฉูุฏ)
  * ุงฺฏุฑ **pointer** ุจุงุดุฏ โ ูุงูฺฉ ุงุณุช (ุฏุฑ ูพุงุงู ุญุฐู ูโฺฉูุฏ)
* `ct` = ุขุฎุฑู ุชูฺฉู ุฎูุงูุฏูโุดุฏู
  ููุฏุงุฑ ุงููู `Kind::end` ูโฺฏุฑุฏ ุชุง ุงฺฏุฑ ฺฉุงุฑุจุฑ ุงุดุชุจุงู ุงุณุชูุงุฏู ฺฉุฑุฏุ ููุฏุงุฑ ุจโูุนู ูฺฏุฑุฏ.

---

## ุชุงุจุน get() ฺู ูโฺฉูุฏุ

ูุฏู: ุฎูุงูุฏู ฺฉ ฺฉุงุฑุงฺฉุชุฑุ ุชุดุฎุต ููุน ุชูฺฉูุ ุฎูุงูุฏู ุจูู ฺฉุงุฑุงฺฉุชุฑูุง ุฏุฑ ุตูุฑุช ูุงุฒูุ ู ุณุงุฎุชู ุชูฺฉู.

### ุดุฑูุน ฺฉุงุฑ

```cpp
char ch = 0;
*ip >> ch;
```

ุงู ุงููู ฺฉุงุฑุงฺฉุชุฑ ุบุฑ ูุงุตูู ุฑุง ูโฺฏุฑุฏ. ุงฺฏุฑ ุฎูุงูุฏู ูููู ูุจุงุดุฏุ `ch` ุตูุฑ ูโูุงูุฏุ ุนู ูพุงุงู ูุฑูุฏ:

```cpp
case 0:
    return ct={Kind::end};
```

---

## ุชุจุฏู ฺฉุงุฑุงฺฉุชุฑูุง ูุนููู ุจู ุชูฺฉู

ุงฺฏุฑ ฺฉุงุฑุงฺฉุชุฑ ฺฉ ุงุฒ ุงูโูุง ุจุงุดุฏ:

`;  *  /  +  -  (  )  =`

ูุณุชููุงู ุชุจุฏู ุจู `Token` ูโุดูุฏ:

```cpp
return ct={static_cast<Kind>(ch)};
```

`static_cast` ฺูู ุชุจุฏู ุฎูุฏฺฉุงุฑ ุงุฒ `char` ุจู `Kind` ูุฌุงุฒ ูุณุช.

---

## ุฎูุงูุฏู ุนุฏุฏ

ุงฺฏุฑ ุงููู ฺฉุงุฑุงฺฉุชุฑ ุนุฏุฏ ุง `.` ุจุงุดุฏ:

```cpp
ip->putback(ch); 
*ip >> ct.number_value;
ct.kind = Kind::number;
return ct;
```

* ฺฉุงุฑุงฺฉุชุฑ ุฑุง ุจุฑูโฺฏุฑุฏุงูู
* ุนุฏุฏ ุฑุง ุจู ุทูุฑ ฺฉุงูู ูโุฎูุงูู (ุจุฑุง ูุซุงู `3.14`)
* ููุน ุชูฺฉู ุฑุง ุนุฏุฏ ูุฑุงุฑ ูโุฏูู

---

## ุฎูุงูุฏู ุงุณู (name)

ุงฺฏุฑ ุงููู ฺฉุงุฑุงฺฉุชุฑ ุญุฑู ุจุงุดุฏ:

```cpp
ip->putback(ch);
*ip >> ct.string_value;
ct.kind = Kind::name;
return ct;
```

* ูุนูููุงู ุจู ูุนู ูุชุบุฑ ุง ุดูุงุณู ุงุณุช
* `>>` ุจุฑุง string ุชุง ูุงุตูู ูโุฎูุงูุฏ
  (ุงู ุนู ฺฉุงุฑุจุฑ ุจุงุฏ ุจู ูุงู ู ุนููฺฏุฑ ูุงุตูู ุจฺฏุฐุงุฑุฏ โ ุจุนุฏุงู ุจูุชุฑ ูโุดูุฏ)

---

## ุฎุทุง

ุงฺฏุฑ ูฺโฺฉุฏุงู ูุจูุฏ:

```cpp
error("bad token");
return ct={Kind::print};
```

ุนู ูุฑูุฏ ุบูุท ุงุณุช.

---

## ูุณุฎู ฺฉุงูู ุชุงุจุน get()

```cpp
Token Token_stream::get()
{
    char ch = 0;
    *ip >> ch;
    switch (ch) {
    case 0:
        return ct={Kind::end};
    case ';': case '*': case '/': case '+': case '-':
    case '(' : case ')' : case '=':
        return ct={static_cast<Kind>(ch)};
    case '0': case '1': case '2': case '3': case '4':
    case '5': case '6': case '7': case '8': case '9':
    case '.':
        ip->putback(ch);
        *ip >> ct.number_value;
        ct.kind = Kind::number;
        return ct;
    default:
        if (isalpha(ch)) {
            ip->putback(ch);
            *ip >> ct.string_value;
            ct.kind = Kind::name;
            return ct;
        }
        error("bad token");
        return ct={Kind::print};
    }
}
```

--------
--------

### ๐งฉ ุชุนุฑู ฺฉู

ุฏุฑ ุงู ุจุฎุดุ ููุณูุฏู (ุจุงุฑู ุงุณุชุฑูุณุชุฑููพ) ุฏุงุฑุฏ **ฺฉูุงุณ `Token_stream`** ุฑุง ูุนุฑู ูโฺฉูุฏ.
ุงู ฺฉูุงุณ ุจุฎุด ุงุฒ ฺฉ ุจุฑูุงููโ ููุณุฑ ุง ูุงุดูโุญุณุงุจ ุงุณุช ฺฉู ุจุงุฏ ูุฑูุฏ ฺฉุงุฑุจุฑ ุฑุง **ุจูโุตูุฑุช ุชูฺฉู (Token)** ุจุฎูุงูุฏ.
ูุฑ ุชูฺฉู ูโุชูุงูุฏ ูุซูุงู ุนุฏุฏุ ุนููฺฏุฑ (+ุ -ุ *)ุ ูพุฑุงูุชุฒุ ุง ูุงู ูุชุบุฑ ุจุงุดุฏ.

---

### ๐งฑ ุณุงุฎุชุงุฑ ฺฉูุงุณ

ฺฉูุงุณ ุงูโุทูุฑ ุชุนุฑู ุดุฏู:

```cpp
class Token_stream {
public:
    Token_stream(istream& s) : ip{&s}, owns{false} { }
    Token_stream(istream* p) : ip{p}, owns{true} { }
    ~Token_stream() { close(); }

    Token get();         // ุฎูุงูุฏู ู ุจุฑฺฏุฑุฏุงูุฏู ุชูฺฉู ุจุนุฏ
    Token& current();    // ุจุฑฺฏุฑุฏุงูุฏู ุขุฎุฑู ุชูฺฉู ุฎูุงูุฏูโุดุฏู

    void set_input(istream& s) { close(); ip = &s; owns = false; }
    void set_input(istream* p) { close(); ip = p; owns = true; }

private:
    void close() { if (owns) delete ip; }

    istream* ip;         // ุงุดุงุฑูโฺฏุฑ ุจู ุฌุฑุงู ูุฑูุฏ (input stream)
    bool owns;           // ุขุง ุงู ุดุก ูุงูฺฉ ุฌุฑุงู ูุฑูุฏ ุงุณุช ุง ููุ
    Token ct {Kind::end}; // ุขุฎุฑู ุชูฺฉู ุฎูุงูุฏูโุดุฏู (current token)
};
```

---

### ๐ง ุญุงูุง ุฌูููโุจูโุฌููู ูุนู ฺฉูู:

> We initialize a Token_stream with an input stream (from which it gets its characters).

ุนู:
ูุง ุดุก `Token_stream` ุฑุง ุจุง ฺฉ **ุฌุฑุงู ูุฑูุฏ** ููุฏุงุฑุฏู ุงููู ูโฺฉูู.
ุงู ุฌุฑุงู ููุงู ุฌุง ุงุณุช ฺฉู ฺฉูุงุณ ุงุฒ ุขู **ฺฉุงุฑุงฺฉุชุฑูุง ุฑุง ูโุฎูุงูุฏ** โ ูุนูููุงู `cin` ุง ูุงู.

ูุซูุงู:

```cpp
Token_stream ts(cin);
```

ุฏุฑ ุงูุฌุงุ `ts` ุงุฒ ูุฑูุฏ ฺฉุงุฑุจุฑ (ฺฉุจูุฑุฏ) ูโุฎูุงูุฏ.

---

> The Token_stream implements the convention that it owns (and eventually deletes) an istream passed as a pointer, but not an istream passed as a reference.

ุนู:
ฺฉูุงุณ `Token_stream` ฺฉ **ูุงุนุฏู (ูุงุนุฏูโ ูุงูฺฉุช)** ุฏุงุฑุฏ:

* ุงฺฏุฑ ูุฑูุฏ ุจู ุขู ุจูโุตูุฑุช **ุงุฑุฌุงุน (reference)** ุฏุงุฏู ุดูุฏุ ูุซู `Token_stream ts(cin);`
  โ ฺฉูุงุณ ูุงูฺฉ ูุฑูุฏ ูุณุช (ุนู ูุจุงุฏ ุขู ุฑุง ูพุงฺฉ ฺฉูุฏ).

* ุงฺฏุฑ ูุฑูุฏ ุจู ุขู ุจูโุตูุฑุช **ุงุดุงุฑูโฺฏุฑ (pointer)** ุฏุงุฏู ุดูุฏุ ูุซู:

  ```cpp
  Token_stream ts(new istringstream("2+2"));
  ```

  โ ฺฉูุงุณ **ูุงูฺฉ** ุขู ุฌุฑุงู ุงุณุช ู ุฏุฑ ูพุงุงู ุนูุฑุด (ุฏุฑ destructor) ุฎูุฏุด ุขู ุฑุง `delete` ูโฺฉูุฏ.

---

> This may be a bit elaborate for this simple program, but it is a useful and general technique for classes that hold a pointer to a resource requiring destruction.

ุนู:
ุดุงุฏ ุงู ุทุฑุงุญ ุจุฑุง ฺูู ุจุฑูุงููโ ุณุงุฏูโุง ฺฉู ูพฺุฏู ุจู ูุธุฑ ุจุฑุณุฏุ
ุงูุง ุฏุฑ ูุงูุน **ฺฉ ุงูฺฏู ฺฉู ู ููุฏ** ุงุณุช ุจุฑุง ูุฑ ฺฉูุงุณ ฺฉู **ููุจุน** (ูุซู ูุงูุ ุฌุฑุงูุ ุญุงูุธูโ ุฏุงูุงูฺฉ ู ...) ุฑุง ุงุฒ ุทุฑู ุงุดุงุฑูโฺฏุฑ ูฺฏู ูโุฏุงุฑุฏ โ ฺูู ุจุงุฏ ูุดุฎุต ุจุงุดุฏ ฺู ฺฉุณ ูุณุฆูู ูพุงฺฉโฺฉุฑุฏู ุขู ุงุณุช.

---

> A Token_stream holds three values:
> a pointer to its input stream (`ip`),
> a Boolean (`owns`) indicating ownership,
> and the current token (`ct`).

ุนู:
ูุฑ ุดุก `Token_stream` ุณู ุฏุงุฏู ูฺฏู ูโุฏุงุฑุฏ:

1. `ip`: ุงุดุงุฑูโฺฏุฑ ุจู ูุฑูุฏ (ุงุฒ ููุน `istream*`) ฺฉู ุงุฒ ุขู ุฏุงุฏู ูโุฎูุงูุฏ.
2. `owns`: ูุดุฎุต ูโฺฉูุฏ ฺฉู ุขุง ุงู ุดุก ูุงูฺฉ ูุฑูุฏ ุงุณุช ุง ูู (ุงฺฏุฑ `true` ุจุงุดุฏุ ุจุงุฏ ุฏุฑ ูพุงุงู `delete` ฺฉูุฏ).
3. `ct`: ุขุฎุฑู ุชูฺฉู ุฎูุงูุฏูโุดุฏู (ูุชุบุฑ ุงุฒ ููุน `Token`).

---

### ๐ง ุฌูุนโุจูุฏ ุจุง ูุซุงู

ูุฑุถ ฺฉู ุฏู ุญุงูุช ุฒุฑ ูุฌูุฏ ุฏุงุฑุฏ:

#### ุญุงูุช ฑ:

```cpp
Token_stream ts(cin);
```

ุฏุฑ ุงู ุญุงูุช:

* `ip` ุงุดุงุฑู ูโฺฉูุฏ ุจู `cin`
* `owns = false`
* ุนู: ยซุงู ุดุก ููุท ุงุฒ cin ุงุณุชูุงุฏู ูโฺฉูุฏ ูู ูุจุงุฏ ุขู ุฑุง ุญุฐู ฺฉูุฏ.ยป

#### ุญุงูุช ฒ:

```cpp
Token_stream ts(new istringstream("3 + 4 * 5"));
```

ุฏุฑ ุงู ุญุงูุช:

* `ip` ุงุดุงุฑู ูโฺฉูุฏ ุจู ุดุก ุฌุฏุฏ ุงุฒ ููุน `istringstream`
* `owns = true`
* ุนู: ยซุงู ุดุก ุตุงุญุจ ุฌุฑุงู ุงุณุช ู ููุช ุงุฒ ุจู ุฑูุช ุจุงุฏ ุขู ุฑุง delete ฺฉูุฏ.ยป


--------
--------

## Low-Level Input
ุงุณุชูุงุฏู ุงุฒ ูุงุดูโุญุณุงุจ ฺฉู ุชุง ุงูุฌุง ุชุนุฑู ฺฉุฑุฏูโุงู ฺูุฏ ุงุฑุงุฏ ุฏุงุฑุฏ. ฺฉ ุงูโฺฉู ุจุงุฏ ููุดู ุจุนุฏ ุงุฒ ูุฑ ุนุจุงุฑุช ฺฉ **ููุทูโูุฑฺฏูู (semicolon)** ุจฺฏุฐุงุฑู ุชุง ููุฏุงุฑ ุขู ฺุงูพ ุดูุฏุ ฺฉู ฺฉุงุฑ ุฎุณุชูโฺฉููุฏูโุง ุงุณุช. ุงุฑุงุฏ ุฏฺฏุฑ ุงู ุงุณุช ฺฉู ุงฺฏุฑ ูุงู (identifier) ููุท ุจุง **ูุงุตููโ ุณูุฏ (whitespace)** ุชูุงู ุดูุฏุ ุจุงุนุซ ุฏุฑุฏุณุฑ ูโุดูุฏ. ุจุฑุง ูุซุงู:
`x=7` ุจู ุนููุงู ฺฉ ุดูุงุณู (identifier) ุฏุฑ ูุธุฑ ฺฏุฑูุชู ูโุดูุฏ โ ูู ุดูุงุณูโ `x` ุจูโุนูุงููโ ุนููฺฏุฑ `=` ู ุนุฏุฏ `7`. ุจุฑุง ุงูฺฉู ุฎุฑูุฌ ููุงู ฺุฒ ุดูุฏ ฺฉู ูุนูููุงู ุงูุชุธุงุฑ ุฏุงุฑูุ ุจุงุฏ ุจุนุฏ ุงุฒ `x` ฺฉ ูุงุตูู ุงุถุงูู ฺฉูู:
`x =7`
ูุฑ ุฏู ูุดฺฉู ุฑุง ูโุชูุงู ุจุง ุฌุงฺฏุฒู ฺฉุฑุฏู ุนููุงุช ูุฑูุฏ ูพุดโูุฑุถ ฺฉู ูุจุชู ุจุฑ ููุน ูุณุชูุฏุ ุจุง ฺฉุฏ ฺฉู ุชฺฉโุชฺฉ ฺฉุงุฑุงฺฉุชุฑูุง ุฑุง ูโุฎูุงูุฏุ ุญู ฺฉุฑุฏ.

---

### ฑ. ูุนุงุฏู ฺฉุฑุฏู **newline** ุจุง **semicolon** (ูพุงุงู ุนุจุงุฑุช)

ุฏุฑ ุงู ุจุฎุด ุงุฒ ฺฉุฏุ ฺฉ **ุฎุท ุฌุฏุฏ (`\n`)** ุฑุง ูุนุงุฏู ุจุง **`;`** ุฏุฑ ูุธุฑ ูโฺฏุฑู ุชุง ูุดุงูฺฏุฑ ูพุงุงู ฺฉ ุนุจุงุฑุช ุจุงุดุฏ:

```cpp
Token Token_stream::get()
{
    char ch;
    do { // skip whitespace except โ\nโ
        if (!ip->get(ch)) return ct={Kind::end};
    } while (ch!='\n' && isspace(ch));
    switch (ch) {
    case ';':
    case '\n':
        return ct={Kind::print};
```

ุฏุฑ ุงูุฌุง ุงุฒ ฺฉ **ุฏุณุชูุฑ do-while** ุงุณุชูุงุฏู ุดุฏู ุงุณุช. ุงู ุฏุณุชูุฑ ุดุจู **while** ุงุณุชุ ุจุง ุงู ุชูุงูุช ฺฉู ุจุฏููโ ุขู **ุญุฏุงูู ฺฉ ุจุงุฑ ุงุฌุฑุง ูโุดูุฏ**.
ุชุงุจุน `ip->get(ch)` ฺฉ ฺฉุงุฑุงฺฉุชุฑ ุฑุง ุงุฒ ุฌุฑุงู ูุฑูุฏ (`*ip`) ูโุฎูุงูุฏ ู ุฏุฑ ูุชุบุฑ `ch` ูุฑุงุฑ ูโุฏูุฏ.
ุจุฑุฎูุงู ุนููฺฏุฑ `>>`ุ ุชุงุจุน `get()` **ูุงุตููโูุง ุฑุง ุฑุฏ ููโฺฉูุฏ**.
ุขุฒููู `if (!ip->get(ch))` ุฒูุงู ุจุฑูุฑุงุฑ ุงุณุช ฺฉู ุฏฺฏุฑ ูุชูุงู ฺฉุงุฑุงฺฉุชุฑ ุงุฒ `cin` ุฎูุงูุฏุ ุฏุฑ ุงู ุญุงูุชุ ุชูฺฉู ุงุฒ ููุน `Kind::end` ุจุฑฺฏุฑุฏุงูุฏู ูโุดูุฏ ุชุง ุจุฑูุงููโ ูุงุดูโุญุณุงุจ ุฎุงุชูู ุงุจุฏ.
ุนููฺฏุฑ `!` (not) ุงุณุชูุงุฏู ุดุฏู ฺูู `get()` ุฏุฑ ุตูุฑุช ููููุช ููุฏุงุฑ **true** ุจุฑูโฺฏุฑุฏุงูุฏ.

ุชุงุจุน ุงุณุชุงูุฏุงุฑุฏ `isspace()` ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุขุง ฺฉ ฺฉุงุฑุงฺฉุชุฑ ูุงุตููโ ุณูุฏ ุงุณุช ุง ูู. ุงู ุชุงุจุน ุจุฑุง ูุฑ ฺฉุงุฑุงฺฉุชุฑ ุจุง **ุฌุณุชโูุฌู ุฏุฑ ุฌุฏูู** ฺฉุงุฑ ูโฺฉูุฏุ ุจูุงุจุฑุงู ุงุฒ ุจุฑุฑุณ ุชฺฉโุชฺฉ ฺฉุงุฑุงฺฉุชุฑูุง ุณุฑุนโุชุฑ ุงุณุช.
ุชุงุจุนโูุง ูุดุงุจู ุฏฺฏุฑ ูู ูุฌูุฏ ุฏุงุฑูุฏ ูุซู:

* `isdigit()` ุจุฑุง ุจุฑุฑุณ ุนุฏุฏ ุจูุฏู ฺฉุงุฑุงฺฉุชุฑ
* `isalpha()` ุจุฑุง ุจุฑุฑุณ ุญุฑู ุจูุฏู
* `isalnum()` ุจุฑุง ุจุฑุฑุณ ุญุฑู ุง ุนุฏุฏ ุจูุฏู

---

### ฒ. ุญู ูุดฺฉู ุฎูุงูุฏู ุดูุงุณูโูุง (ูุงูโูุง)

ูุดฺฉู ุงู ุจูุฏ ฺฉู `>>` ููุช ุจู ุฏุงุฎู ฺฉ ุฑุดุชู ูโุฎูุงูุฏุ ุชุง ูุจู ุงุฒ ุงููู ูุงุตูู ุณูุฏ ุงุฏุงูู ูโุฏูุฏ.
ุจุฑุง ุญู ุงู ูุดฺฉูุ ุญุงูุง ุชฺฉโุชฺฉ ฺฉุงุฑุงฺฉุชุฑูุง ุฑุง ูโุฎูุงูู ุชุง ุจู ฺฉุงุฑุงฺฉุชุฑ ุจุฑุณู ฺฉู ูู ุญุฑู ุงุณุช ู ูู ุนุฏุฏ:

```cpp
default: // NAME, NAME=, or error
    if (isalpha(ch)) {
        string_value = ch;
        while (ip->get(ch) && isalnum(ch))
            string_value += ch; // append ch to end of string_value
        ip->putback(ch);
        return ct={Kind::name};
    }
```

---

### ณ. ูฺฉุชู ุทุฑุงุญ

ุฎูุดุจุฎุชุงููุ ูุฑ ุฏู ุจูุจูุฏ ุจุงูุง ุฑุง ูโุชูุงู **ููุท ุจุง ุชุบุฑ ฺฉ ุจุฎุด ูุญู ุงุฒ ฺฉุฏ** ูพุงุฏูโุณุงุฒ ฺฉุฑุฏ.
ุทุฑุงุญ ุจุฑูุงููโูุง ุจู ฺฏูููโุง ฺฉู ุชุบุฑุงุช ู ุจูุจูุฏูุง ุชููุง ุฏุฑ ุจุฎุดโูุง ฺฉูฺฺฉ ู ูุญู ุงุนูุงู ุดููุฏุ ฺฉ ุงุฒ ุงูุฏุงู ููู ุทุฑุงุญ ูุฑูโุงูุฒุงุฑ ุงุณุช.

---

### ด. ูฺฉุชู ุฏุฑุจุงุฑูโ ฺฉุงุฑุง ุฑุดุชูโูุง

ููฺฉู ุงุณุช ูฺฏุฑุงู ุจุงุดุฏ ฺฉู ุงูุฒูุฏู ฺฉุงุฑุงฺฉุชุฑูุง ฺฉโฺฉ ุจู ุงูุชูุง ุฑุดุชู ููฺฉู ุงุณุช ฺฉูุฏ ุจุงุดุฏ.
ุฏุฑ ููุฑุฏ ุฑุดุชูโูุง ุฎู ุทููุงู ุงู ูฺฏุฑุงู ุฏุฑุณุช ุงุณุชุ ุงูุง ุชูุฑุจุงู ูููโ ูพุงุฏูโุณุงุฒโูุง ูุฏุฑู ุฑุดุชู ุงุฒ **ุจูููโุณุงุฒ ุฑุดุชูโูุง ฺฉูุชุงู (Small String Optimization)** ุงุณุชูุงุฏู ูโฺฉููุฏ.
ุจู ุงู ูุนู ฺฉู ุจุฑุง ุฑุดุชูโูุง ฺฉูุชุงู ฺฉู ูุนูููุงู ุฏุฑ ูุงุดูโุญุณุงุจ ุง ุญุช ฺฉุงููพุงูุฑ ุงุณุชูุงุฏู ูโุดููุฏุ ุนููุงุช ุงูุฒูุฏู ฺฉุงุฑุงฺฉุชุฑูุง ูฺโฺฏููู ุงูุช ฺฉุงุฑุง ุง ุงุณุชูุงุฏู ุงุฒ ุญุงูุธูโ ูพูุง (heap) ูุฏุงุฑุฏ.
ุญุฏุงฺฉุซุฑ ุทูู ุฑุดุชูโุง ฺฉู ุฏุฑ ุญุงูุธูโ ุฏุงุฎู ูฺฏูุฏุงุฑ ูโุดูุฏ (ุจุฏูู ุชุฎุตุต heap) ุจุณุชฺฏ ุจู ูพุงุฏูโุณุงุฒ ุฏุงุฑุฏุ ูู ูุนูููุงู ุญุฏูุฏ **ฑด ฺฉุงุฑุงฺฉุชุฑ** ุงุณุช.

## Error Handling
ููุดู ุดูุงุณุง ู ฺฏุฒุงุฑุด ุฎุทุงูุง ุงููุช ุฒุงุฏ ุฏุงุฑุฏ.
ุจุง ุงู ุญุงูุ ุจุฑุง ุงู ุจุฑูุงููโ ฺฉูฺฺฉ (ูุงุดูโุญุณุงุจ ูุง)ุ ฺฉ ุฑูุด ุณุงุฏู ุจุฑุง ูุฏุฑุช ุฎุทุงูุง ฺฉูุงุช ูโฺฉูุฏ.

ุชุงุจุน `error()` ููุท ุชุนุฏุงุฏ ุฎุทุงูุง ุฑุง ูโุดูุงุฑุฏุ ฺฉ ูพุงู ุฎุทุง ฺุงูพ ูโฺฉูุฏ ู ููุฏุงุฑ ุซุงุจุช ุจุฑูโฺฏุฑุฏุงูุฏ:

```cpp
int no_of_errors;

double error(const string& s)
{
    no_of_errors++;
    cerr << "error: " << s << '\n';
    return 1;
}
```

ุฌุฑุงู ุฎุฑูุฌ `cerr` ฺฉ **ุฌุฑุงู ุฎุฑูุฌ ุจุฏูู ุจุงูุฑ (unbuffered)** ุงุณุช ฺฉู ูุนูููุงู ุจุฑุง ููุงุด ูพุงูโูุง ุฎุทุง ุงุณุชูุงุฏู ูโุดูุฏ.
(ุฏุฑ ูุงูุน ูุซู `cout` ุงุณุชุ ุงูุง ุจุฑุง ุฎุทุงูุง ู ุจุฏูู ุชุฃุฎุฑ ุฏุฑ ููุงุด ุฎุฑูุฌ.)

---

ุฏูู ุงูฺฉู ุงู ุชุงุจุน ฺฉ ููุฏุงุฑ ุจุฑูโฺฏุฑุฏุงูุฏ ุงู ุงุณุช ฺฉู ูุนูููุงู ุฎุทุงูุง **ุฏุฑ ูุณุท ูุญุงุณุจูโ ฺฉ ุนุจุงุฑุช** ุงุชูุงู ูโุงูุชูุฏ.
ุฏุฑ ฺูู ุญุงูุชุ ุจุงุฏ ุง ฺฉู ูุญุงุณุจู ุฑุง ูุชููู ฺฉููุ ุง ููุฏุงุฑ ุฎุงุต ุจุฑฺฏุฑุฏุงูู ฺฉู ุจุงุนุซ ุฎุทุงูุง ุจุนุฏ ูุดูุฏ.
ุฏุฑ ุงู ุจุฑูุงููโ ุณุงุฏูุ ุฑูุด ุฏูู (ุจุฑฺฏุฑุฏุงูุฏู ฺฉ ููุฏุงุฑ ุจโุถุฑุฑุ ูุซู `1`) ฺฉุงู ุงุณุช.

---

ุงฺฏุฑ ุชุงุจุน `Token_stream::get()` ุดูุงุฑูโ ุฎุท ุฑุง ูู ุฐุฎุฑู ูโฺฉุฑุฏุ
ุชุงุจุน `error()` ูโุชูุงูุณุช ุจู ฺฉุงุฑุจุฑ ุจฺฏูุฏ **ุชูุฑุจุงู ุฏุฑ ฺฉุฏุงู ุฎุท ุฎุทุง ุฑุฎ ุฏุงุฏู ุงุณุช**.
ุงู ูุงุจูุช ุฒูุงู ููุฏ ุงุณุช ฺฉู ูุงุดูโุญุณุงุจ ุจูโุตูุฑุช **ุบุฑุชุนุงูู (ูุซูุงู ุจุง ูุงู ูุฑูุฏ)** ุงุณุชูุงุฏู ุดูุฏ.

---

ุฏุฑ ูุณุฎูโูุง ูพฺุฏูโุชุฑุ ุฑูุดโูุง ุงุณุชุงูุฏุงุฑุฏุชุฑ ู ุนูููโุชุฑ ุจุฑุง ูุฏุฑุช ุฎุทุง ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ุฏุฑ ุขู **ุดูุงุณุง ุฎุทุง** ุงุฒ **ุจุงุฒฺฏุฑุฏุงู (ุฑูุน) ุฎุทุง** ุฌุฏุง ูโุดูุฏ.
ฺูู ุณุณุชู ุฑุง ูโุชูุงู ุจุง ุงุณุชูุงุฏู ุงุฒ **ุงุณุชุซูุงูุง (exceptions)** ูพุงุฏูโุณุงุฒ ฺฉุฑุฏ (ุฏุฑ ุจุฎุด ยง2.4.3.1 ู ูุตู ฑณ ฺฉุชุงุจ ุชูุถุญ ุฏุงุฏู ุดุฏู ุงุณุช).

ุงูุง ุจุฑุง ุงู ูุงุดูโุญุณุงุจ ฺฉูฺฺฉ ฑธฐ ุฎุทุ ููู ุฑูุด ุณุงุฏู ฺฉุงููุงู ฺฉุงู ุงุณุช. โ
